<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PICK.GG - LoL Pick Simulator</title>
    <style>
        /* --- 기본 테마 설정 --- */
        :root {
            --bg-color: #010a13;
            --text-color: #f0f0f0;
            --accent-color: #c8aa6e; /* LoL Gold */
            --box-bg: #1e2328;
            --border-color: #463714;
            --hextech-blue: #0ac8b9;
            --danger-color: #ff4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, #1a1a20 0%, #000 100%);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* 드래그 방지 */
        .site-logo, .btn, .lane-card, .champ-card, .slot, .ban-icon, .pool-mini-img, h1, h2, h3, p, span {
            -webkit-user-select: none; user-select: none;
        }
        input, .recommend-card { user-select: text; }

        .container {
            width: 100%;
            max-width: 950px;
            background-color: var(--box-bg);
            border: 2px solid var(--border-color);
            box-shadow: 0 0 30px rgba(0,0,0,0.8), inset 0 0 50px rgba(0,0,0,0.5);
            padding: 40px;
            border-radius: 4px;
            text-align: center;
            position: relative;
        }

        /* --- 사이트 로고 --- */
        .site-logo {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #444;
        }
        .site-logo h1 {
            font-size: 3rem; margin: 0; color: var(--accent-color);
            text-shadow: 0 0 15px rgba(200, 170, 110, 0.3);
            letter-spacing: 2px; font-weight: 800; text-transform: uppercase;
        }
        .site-logo h1 span { color: #fff; }
        .site-logo p { color: #888; margin: 8px 0 0 0; font-size: 1rem; letter-spacing: 1px; }

        h2 { color: var(--accent-color); font-size: 1.5rem; margin-bottom: 20px; text-transform: uppercase; }
        
        /* 화면 전환 */
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 버튼 --- */
        .btn-group { margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
        .btn {
            background-color: var(--box-bg); color: var(--accent-color);
            border: 1px solid var(--accent-color); padding: 10px 25px;
            font-weight: bold; cursor: pointer; font-size: 14px;
            transition: 0.2s; text-transform: uppercase;
        }
        .btn:hover { background-color: var(--accent-color); color: #000; }
        .btn-secondary { border-color: #666; color: #888; }
        .btn-secondary:hover { background-color: #333; color: #fff; border-color: #888; }

        /* 헥스테크 버튼 */
        .btn-hextech {
            background: linear-gradient(135deg, #091428 0%, #005a82 100%);
            border: 2px solid var(--hextech-blue); color: #fff;
            padding: 15px 40px; font-size: 18px; font-weight: 800; letter-spacing: 1px;
            box-shadow: 0 0 15px rgba(10, 200, 185, 0.4), inset 0 0 10px rgba(10, 200, 185, 0.2);
            text-shadow: 0 0 5px rgba(255,255,255,0.5); position: relative;
            clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
            transition: all 0.3s ease;
        }
        .btn-hextech:hover {
            background: linear-gradient(135deg, #005a82 0%, #0ac8b9 100%);
            box-shadow: 0 0 25px rgba(10, 200, 185, 0.8); transform: scale(1.05);
        }
        .btn-hextech:active { transform: scale(0.98); }

        /* --- Step 1 --- */
        .lane-grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .lane-card {
            width: 120px; height: 140px; background-color: #111;
            border: 2px solid #333; box-sizing: border-box;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            flex-direction: column; transition: all 0.2s;
        }
        .lane-card:hover { transform: translateY(-5px); border-color: #666; }
        .lane-card.selected { 
            border-color: var(--accent-color);
            background: linear-gradient(to bottom, #2c281e, #111);
            box-shadow: 0 0 20px rgba(200,170,110,0.2); 
        }
        .lane-img { width: 64px; height: 64px; margin-bottom: 15px; filter: grayscale(100%); transition: 0.2s; }
        .lane-card:hover .lane-img, .lane-card.selected .lane-img { filter: grayscale(0%); }

        /* --- Step 2 & 3 (Pool & Ban Grid) --- */
        .pool-search-container { margin-bottom: 15px; }
        .pool-search-bar {
            width: 100%; max-width: 300px; padding: 10px;
            background: #000; border: 1px solid #444; color: #fff; text-align: center;
        }
        .pool-search-bar:focus { outline: none; border-color: var(--accent-color); }

        .champ-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px;
            height: 450px; overflow-y: auto; overflow-x: hidden; padding: 15px; background: #0f1012; border: 1px solid #333;
            align-content: start;
        }
        .champ-card { 
            cursor: pointer; position: relative; transition: 0.2s; border: 2px solid transparent; padding: 2px;
        }
        .champ-card:hover { transform: scale(1.05); z-index: 10; background: #222; }
        .champ-card img { width: 100%; display: block; }
        .champ-card.selected { border-color: var(--accent-color); } /* Pool 선택 */
        .champ-card.banned-highlight { border-color: var(--danger-color); opacity: 0.5; filter: grayscale(100%); } /* Ban 선택 */
        
        .champ-card.selected img { filter: brightness(1.1); }
	.champ-card span { 
    		display: block; 
    		font-size: 12px; 
    		margin-top: 5px; 
    		color: #888; 
 	 	white-space: nowrap; 
 	 	overflow: hidden;         
  		text-overflow: ellipsis;  
   	 	letter-spacing: -0.5px;  
	}        
	.champ-card.selected span { color: var(--accent-color); font-weight: bold; }

        /* --- Step 3 (Ban) New UI --- */
        #ban-status-bar {
            display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;
            padding: 15px; background: rgba(50, 10, 10, 0.3); border: 1px solid #522; 
            min-height: 50px; flex-wrap: wrap;
        }
        .ban-icon {
            width: 48px; height: 48px; border: 2px solid var(--danger-color); 
            cursor: pointer; position: relative;
        }
        .ban-icon img { width: 100%; height: 100%; }
        .ban-icon::after {
            content: "✕"; position: absolute; top:0; left:0; width:100%; height:100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: red; opacity: 0; background: rgba(0,0,0,0.5);
            transition: 0.2s;
        }
        .ban-icon:hover::after { opacity: 1; }

        /* --- Step 4 (Pick) --- */
        #ban-display-bar {
            display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; opacity: 0.8;
            padding: 10px; background: rgba(0,0,0,0.3);
        }
        .banned-small {
            width: 32px; height: 32px; border: 1px solid #555; filter: grayscale(100%); opacity: 0.7;
        }
        
        #my-pool-bar {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 30px;
            padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 50px;
            min-height: 50px; align-items: center;
        }
        .pool-mini-img {
            width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--accent-color);
            transition: 0.2s; cursor: help;
        }
        
        .draft-container { display: flex; justify-content: space-between; gap: 20px; }
        .team-column { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .team-title { font-size: 1.1rem; margin-bottom: 10px; color: #fff; font-weight: bold; text-transform: uppercase; }
        
        .slot {
            height: 64px; background: #131313; border: 1px solid #333;
            display: flex; align-items: center; padding: 0 10px;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .slot:hover { border-color: #666; background: #1a1a1a; }
        .slot.disabled { 
            cursor: default; opacity: 0.8; border: 1px solid var(--accent-color); background: #1e1810;
        }
        .slot img { width: 44px; height: 44px; border: 1px solid #444; margin-right: 12px; object-fit: cover; }
        
        .mid-action { width: 180px; display: flex; flex-direction: column; justify-content: center; gap: 15px; align-items: center; }

        /* --- Result --- */
        #result-area { margin-top: 40px; border-top: 1px solid #333; padding-top: 30px; animation: fadeIn 0.5s; }
        .recommend-card {
            background: #1a1a1a; padding: 15px; margin-bottom: 12px;
            border-left: 4px solid var(--accent-color);
            display: flex; align-items: center; gap: 20px; text-align: left;
            transition: 0.2s;
        }
        .recommend-card.wildcard { border-left-color: var(--danger-color); background: #251010; }
        .recommend-img { width: 64px; height: 64px; border: 1px solid #555; }
        .rec-info h3 { margin: 0 0 5px 0; color: var(--accent-color); font-size: 1.2rem; }
        .wildcard .rec-info h3 { color: var(--danger-color); }

        /* --- 모달창 --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px);
        }
        .modal-content { 
            background: var(--box-bg); width: 90%; max-width: 500px; padding: 30px; 
            border: 1px solid var(--accent-color); box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .search-bar { 
            width: 100%; padding: 12px; background: #000; border: 1px solid #555; 
            color: #fff; margin-bottom: 20px; box-sizing: border-box; font-size: 1rem;
        }
        .search-results { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            height: 350px; overflow-y: auto; overflow-x: hidden; align-content: start;
        }
        
        /* 이미지 깨짐 방지 꼼수 */
        img { text-indent: -10000px; }
        img:not([src]), img[src=""] { visibility: hidden; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #444; }
        ::-webkit-scrollbar-track { background: #000; }
    </style>
</head>
<body>

<div class="container">
    <div class="site-logo">
        <h1><span>PICK</span> .GG</h1>
        <p>승리를 위한 베스트 픽 시뮬레이터</p>
    </div>

    <!-- Step 1: 라인 선택 -->
    <div id="step-1" class="step active">
        <h2>플레이할 라인을 선택하세요</h2>
        <div class="lane-grid">
            <div class="lane-card" onclick="selectLane('TOP')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-top.png" class="lane-img">
                <div>TOP</div>
            </div>
            <div class="lane-card" onclick="selectLane('JUNGLE')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-jungle.png" class="lane-img">
                <div>JUNGLE</div>
            </div>
            <div class="lane-card" onclick="selectLane('MID')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-middle.png" class="lane-img">
                <div>MID</div>
            </div>
            <div class="lane-card" onclick="selectLane('ADC')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-bottom.png" class="lane-img">
                <div>ADC</div>
            </div>
            <div class="lane-card" onclick="selectLane('SUPPORT')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-utility.png" class="lane-img">
                <div>SUPPORT</div>
            </div>
        </div>
        <div class="btn-group">
            <button class="btn" onclick="goToStep(2)">챔피언 설정하기</button>
        </div>
    </div>

    <!-- Step 2: 챔피언 풀 -->
    <div id="step-2" class="step">
        <h2>내 챔피언 풀 설정</h2>
        <p style="color:#888; margin-bottom:10px;">자신있는 챔피언을 선택하세요 (<span id="pool-count" style="color:var(--accent-color)">0</span> / 7)</p>
        <div class="pool-search-container">
            <input type="text" id="pool-search-input" class="pool-search-bar" placeholder="챔피언 찾기..." onkeyup="filterPoolGrid()">
        </div>
        <div class="champ-grid" id="pool-grid"></div>
        <div class="btn-group">
            <button class="btn btn-secondary" onclick="goToStep(1)">이전 단계</button>
            <button class="btn" onclick="goToStep(3)">밴픽(Ban) 단계로</button>
        </div>
    </div>

    <!-- Step 3: 통합 밴 단계 (수정됨) -->
    <div id="step-3" class="step">
        <h2>금지 챔피언 선택 (BAN)</h2>
        <p style="color:#888; margin-bottom:10px;">이번 게임에서 금지된 챔피언을 선택하세요. (<span id="ban-count" style="color:var(--danger-color)">0</span> / 10)</p>
        
        <!-- 선택된 밴 목록 표시 -->
        <div id="ban-status-bar">
            <!-- JS로 밴 아이콘 채워짐 -->
        </div>

        <!-- 밴 선택용 검색 및 그리드 -->
        <div class="pool-search-container">
            <input type="text" id="ban-search-input" class="pool-search-bar" placeholder="금지할 챔피언 검색..." onkeyup="filterBanGrid()">
        </div>
        <div class="champ-grid" id="ban-selection-grid">
            <!-- JS로 전체 챔피언 채워짐 -->
        </div>

        <div class="btn-group">
            <button class="btn btn-secondary" onclick="goToStep(2)">이전 단계</button>
            <button class="btn" onclick="goToStep(4)">픽(Pick) 단계로</button>
        </div>
    </div>

    <!-- Step 4: 픽 단계 -->
    <div id="step-4" class="step">
        <h2>픽(PICK) 상황 입력</h2>
        
        <!-- 밴 목록 표시 (수정됨) -->
        <div style="text-align:center; margin-bottom:5px;">
            <span style="font-size:12px; color:#ff5c5c;">BANNED CHAMPIONS</span>
        </div>
        <div id="ban-display-bar"></div>

        <p style="margin:15px 0 5px 0; font-size:12px; color:#888;">MY CHAMPION POOL</p>
        <div id="my-pool-bar"></div>

        <div class="draft-container">
            <div class="team-column">
                <div class="team-title" style="color:#5c9dff">아군 (OUR TEAM)</div>
                <div class="slot" data-side="ally" data-role="TOP" onclick="openSelector(this)">Top</div>
                <div class="slot" data-side="ally" data-role="JUNGLE" onclick="openSelector(this)">Jungle</div>
                <div class="slot" data-side="ally" data-role="MID" onclick="openSelector(this)">Mid</div>
                <div class="slot" data-side="ally" data-role="ADC" onclick="openSelector(this)">ADC</div>
                <div class="slot" data-side="ally" data-role="SUPPORT" onclick="openSelector(this)">Support</div>
            </div>
            <div class="mid-action">
                <button class="btn btn-hextech" onclick="getRecommendation()">추천 픽<br>검색</button>
                <button class="btn btn-secondary" onclick="goToStep(3)" style="margin-top:10px;">밴 다시하기</button>
            </div>
            <div class="team-column">
                <div class="team-title" style="color:#ff5c5c">적군 (ENEMY TEAM)</div>
                <div class="slot" data-side="enemy" data-role="TOP" onclick="openSelector(this)">Top</div>
                <div class="slot" data-side="enemy" data-role="JUNGLE" onclick="openSelector(this)">Jungle</div>
                <div class="slot" data-side="enemy" data-role="MID" onclick="openSelector(this)">Mid</div>
                <div class="slot" data-side="enemy" data-role="ADC" onclick="openSelector(this)">ADC</div>
                <div class="slot" data-side="enemy" data-role="SUPPORT" onclick="openSelector(this)">Support</div>
            </div>
        </div>

        <div id="result-area" style="display:none;">
            <h2>AI 분석 추천 픽</h2>
            <div id="recommendation-list"></div>
        </div>
    </div>
</div>

<!-- 픽 모달창 -->
<div id="modal-overlay">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--accent-color);">챔피언 선택</h3>
        <p style="font-size:12px; color:#888; margin-bottom:10px;">기본적으로 해당 라인 챔피언이 보입니다.</p>
        <input type="text" class="search-bar" id="champ-search" placeholder="챔피언 검색..." onkeyup="filterChampions()">
        <div class="search-results" id="modal-list"></div>
        <button class="btn btn-secondary" style="width:100%; margin-top:15px;" onclick="closeModal()">취소</button>
    </div>
</div>

<script>
    // --- 챔피언 데이터베이스 ---
    const championDB = [
        { id: 'Aatrox', name: '아트록스', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Ahri', name: '아리', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Akali', name: '아칼리', roles: ['MID', 'TOP'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Akshan', name: '아크샨', roles: ['MID', 'TOP'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Alistar', name: '알리스타', roles: ['SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Ambessa', name: '암베사', roles: ['TOP', 'JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Amumu', name: '아무무', roles: ['JUNGLE', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Anivia', name: '애니비아', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Annie', name: '애니', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Aphelios', name: '아펠리오스', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Ashe', name: '애쉬', roles: ['ADC', 'SUPPORT'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'AurelionSol', name: '아우렐리온 솔', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Aurora', name: '오로라', roles: ['MID', 'TOP'], damage: 'AP', type: 'MAGE' },
        { id: 'Azir', name: '아지르', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Bard', name: '바드', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Belveth', name: '벨베스', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Blitzcrank', name: '블리츠크랭크', roles: ['SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Brand', name: '브랜드', roles: ['SUPPORT', 'JUNGLE', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Braum', name: '브라움', roles: ['SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Briar', name: '브라이어', roles: ['JUNGLE', 'TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Caitlyn', name: '케이틀린', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Camille', name: '카밀', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Cassiopeia', name: '카시오페아', roles: ['MID', 'TOP'], damage: 'AP', type: 'MAGE' },
        { id: 'Chogath', name: '초가스', roles: ['TOP', 'MID'], damage: 'AP', type: 'TANK' },
        { id: 'Corki', name: '코르키', roles: ['MID', 'ADC'], damage: 'MIX', type: 'MARKSMAN' },
        { id: 'Darius', name: '다리우스', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Diana', name: '다이애나', roles: ['JUNGLE', 'MID'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'DrMundo', name: '문도 박사', roles: ['TOP', 'JUNGLE'], damage: 'MIX', type: 'TANK' },
        { id: 'Draven', name: '드레이븐', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Ekko', name: '에코', roles: ['JUNGLE', 'MID'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Elise', name: '엘리스', roles: ['JUNGLE'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Evelynn', name: '이블린', roles: ['JUNGLE'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Ezreal', name: '이즈리얼', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Fiddlesticks', name: '피들스틱', roles: ['JUNGLE', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Fiora', name: '피오라', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Fizz', name: '피즈', roles: ['MID'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Galio', name: '갈리오', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Gangplank', name: '갱플랭크', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Garen', name: '가렌', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Gnar', name: '나르', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Gragas', name: '그라가스', roles: ['JUNGLE', 'TOP', 'MID', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Graves', name: '그레이브즈', roles: ['JUNGLE'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Gwen', name: '그웬', roles: ['TOP', 'JUNGLE'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Hecarim', name: '헤카림', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Heimerdinger', name: '하이머딩거', roles: ['SUPPORT', 'MID', 'TOP'], damage: 'AP', type: 'MAGE' },
        { id: 'Hwei', name: '흐웨이', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Illaoi', name: '일라오이', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Irelia', name: '이렐리아', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Ivern', name: '아이번', roles: ['JUNGLE'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Janna', name: '잔나', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'JarvanIV', name: '자르반 4세', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Jax', name: '잭스', roles: ['TOP', 'JUNGLE'], damage: 'MIX', type: 'FIGHTER' },
        { id: 'Jayce', name: '제이스', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Jhin', name: '진', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Jinx', name: '징크스', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'KSante', name: '크산테', roles: ['TOP'], damage: 'AD', type: 'TANK' }, 
        { id: 'Kaisa', name: '카이사', roles: ['ADC'], damage: 'MIX', type: 'MARKSMAN' },
        { id: 'Kalista', name: '칼리스타', roles: ['ADC', 'TOP'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Karma', name: '카르마', roles: ['SUPPORT', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Karthus', name: '카서스', roles: ['JUNGLE', 'ADC'], damage: 'AP', type: 'MAGE' },
        { id: 'Kassadin', name: '카사딘', roles: ['MID'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Katarina', name: '카타리나', roles: ['MID'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Kayle', name: '케일', roles: ['TOP', 'MID'], damage: 'MIX', type: 'FIGHTER' },
        { id: 'Kayn', name: '케인', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Kennen', name: '케넨', roles: ['TOP', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Khazix', name: '카직스', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Kindred', name: '킨드레드', roles: ['JUNGLE'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Kled', name: '클레드', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'KogMaw', name: '코그모', roles: ['ADC'], damage: 'MIX', type: 'MARKSMAN' },
        { id: 'Leblanc', name: '르블랑', roles: ['MID'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'LeeSin', name: '리신', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Leona', name: '레오나', roles: ['SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Lillia', name: '릴리아', roles: ['JUNGLE'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Lissandra', name: '리산드라', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Lucian', name: '루시안', roles: ['ADC', 'MID'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Lulu', name: '룰루', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Lux', name: '럭스', roles: ['SUPPORT', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Malphite', name: '말파이트', roles: ['TOP', 'MID', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Malzahar', name: '말자하', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Maokai', name: '마오카이', roles: ['SUPPORT', 'JUNGLE', 'TOP'], damage: 'AP', type: 'TANK' },
        { id: 'MasterYi', name: '마스터 이', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Mel', name: '멜', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Milio', name: '밀리오', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'MissFortune', name: '미스 포츈', roles: ['ADC', 'SUPPORT'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'MonkeyKing', name: '오공', roles: ['JUNGLE', 'TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Mordekaiser', name: '모데카이저', roles: ['TOP'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Morgana', name: '모르가나', roles: ['SUPPORT', 'JUNGLE'], damage: 'AP', type: 'MAGE' },
        { id: 'Naafiri', name: '나피리', roles: ['MID'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Nami', name: '나미', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Nasus', name: '나서스', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Neeko', name: '니코', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Nidalee', name: '니달리', roles: ['JUNGLE'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Nilah', name: '닐라', roles: ['ADC'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Nocturne', name: '녹턴', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Nunu', name: '누누와 윌럼프', roles: ['JUNGLE'], damage: 'AP', type: 'TANK' },
        { id: 'Olaf', name: '올라프', roles: ['TOP', 'JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Orianna', name: '오리아나', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Ornn', name: '오른', roles: ['TOP'], damage: 'MIX', type: 'TANK' },
        { id: 'Pantheon', name: '판테온', roles: ['MID', 'TOP', 'SUPPORT'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Poppy', name: '뽀삐', roles: ['JUNGLE', 'TOP', 'SUPPORT'], damage: 'AD', type: 'TANK' },
        { id: 'Pyke', name: '파이크', roles: ['SUPPORT'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Qiyana', name: '키아나', roles: ['MID', 'JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Quinn', name: '퀸', roles: ['TOP'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Rakan', name: '라칸', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'RekSai', name: '렉사이', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Rell', name: '렐', roles: ['SUPPORT', 'JUNGLE'], damage: 'MIX', type: 'TANK' },
        { id: 'Renata', name: '레나타 글라스크', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Renekton', name: '레넥톤', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Rengar', name: '렝가', roles: ['JUNGLE', 'TOP'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Riven', name: '리븐', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Ryze', name: '라이즈', roles: ['MID', 'TOP'], damage: 'AP', type: 'MAGE' },
        { id: 'Samira', name: '사미라', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Sejuani', name: '세주아니', roles: ['JUNGLE', 'TOP'], damage: 'AP', type: 'TANK' },
        { id: 'Senna', name: '세나', roles: ['SUPPORT', 'ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Seraphine', name: '세라핀', roles: ['SUPPORT', 'ADC', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Sett', name: '세트', roles: ['TOP', 'SUPPORT'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Shaco', name: '샤코', roles: ['JUNGLE', 'SUPPORT'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Shen', name: '쉔', roles: ['TOP', 'SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Shyvana', name: '쉬바나', roles: ['JUNGLE'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Singed', name: '신지드', roles: ['TOP'], damage: 'AP', type: 'TANK' },
        { id: 'Sion', name: '사이온', roles: ['TOP'], damage: 'AD', type: 'TANK' },
        { id: 'Sivir', name: '시비르', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Skarner', name: '스카너', roles: ['JUNGLE', 'TOP'], damage: 'MIX', type: 'TANK' },
        { id: 'Smolder', name: '스몰더', roles: ['ADC', 'MID'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Sona', name: '소나', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Soraka', name: '소라카', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Swain', name: '스웨인', roles: ['SUPPORT', 'MID', 'ADC'], damage: 'AP', type: 'MAGE' },
        { id: 'Sylas', name: '사일러스', roles: ['MID', 'JUNGLE'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Syndra', name: '신드라', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'TahmKench', name: '탐 켄치', roles: ['TOP', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Taliyah', name: '탈리야', roles: ['JUNGLE', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Talon', name: '탈론', roles: ['JUNGLE', 'MID'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Taric', name: '타릭', roles: ['SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Teemo', name: '티모', roles: ['TOP', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Thresh', name: '쓰레쉬', roles: ['SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Tristana', name: '트리스타나', roles: ['ADC', 'MID'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Trundle', name: '트런들', roles: ['TOP', 'JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Tryndamere', name: '트린다미어', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'TwistedFate', name: '트위스티드 페이트', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Twitch', name: '트위치', roles: ['ADC', 'SUPPORT'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Udyr', name: '우디르', roles: ['JUNGLE', 'TOP'], damage: 'MIX', type: 'FIGHTER' },
        { id: 'Urgot', name: '우르곳', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Varus', name: '바루스', roles: ['ADC', 'MID'], damage: 'MIX', type: 'MARKSMAN' },
        { id: 'Vayne', name: '베인', roles: ['ADC', 'TOP'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Veigar', name: '베이가', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Vex', name: '벡스', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Vi', name: '바이', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Vladimir', name: '블라디미르', roles: ['MID', 'TOP'], damage: 'AP', type: 'MAGE' },
        { id: 'Warwick', name: '워윅', roles: ['JUNGLE', 'TOP'], damage: 'MIX', type: 'FIGHTER' },
        { id: 'Xayah', name: '자야', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Xerath', name: '제라스', roles: ['SUPPORT', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'XinZhao', name: '신 짜오', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Yasuo', name: '야스오', roles: ['MID', 'TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Yone', name: '요네', roles: ['MID', 'TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Yorick', name: '요릭', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Yuumi', name: '유미', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Yunara', name: '유나라', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Zaahen', name: '자헨', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Zac', name: '자크', roles: ['JUNGLE', 'TOP'], damage: 'AP', type: 'TANK' },
        { id: 'Zed', name: '제드', roles: ['MID', 'JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Zeri', name: '제리', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Ziggs', name: '직스', roles: ['ADC', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Zilean', name: '질리언', roles: ['SUPPORT', 'MID'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Zoe', name: '조이', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Zyra', name: '자이라', roles: ['SUPPORT'], damage: 'AP', type: 'MAGE' }
    ];

    let state = {
        myLane: null,
        myPool: [],
        bannedChampions: [], // [수정] 통합된 밴 목록
        draft: {
            ally: { TOP: null, JUNGLE: null, MID: null, ADC: null, SUPPORT: null },
            enemy: { TOP: null, JUNGLE: null, MID: null, ADC: null, SUPPORT: null }
        },
        currentSelector: null
    };

    function getImg(id) {
        const customImages = {
            'Mel': 'https://opgg-static.akamaized.net/meta/images/lol/15.24.1/champion/Mel.png',
            'Yunara': 'https://opgg-static.akamaized.net/meta/images/lol/15.24.1/champion/Yunara.png',
            'Zaahen': 'https://opgg-static.akamaized.net/meta/images/lol/15.24.1/champion/Zaahen.png',
        };
        if (customImages[id]) return customImages[id];
        return `https://ddragon.leagueoflegends.com/cdn/14.23.1/img/champion/${id}.png`;
    }

    // --- Step 1 ---
    function selectLane(lane) {
        if(state.myLane !== lane) {
            state.myPool = [];
            document.getElementById('pool-count').innerText = "0";
        }
        state.myLane = lane;
        document.querySelectorAll('.lane-card').forEach(c => c.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
    }

    function goToStep(num) {
        if(num === 2 && !state.myLane) return alert('라인을 선택해주세요!');
        if(num >= 3 && state.myPool.length === 0) return alert('챔피언을 선택해주세요!');

        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('step-' + num).classList.add('active');

        if(num === 2) {
            renderPool();
            document.getElementById('pool-search-input').value = ''; 
        }
        if(num === 3) {
            initBanPhase(); // [수정] 통합 밴 화면 초기화
        }
        if(num === 4) initDraft();
    }

    // --- Step 2 ---
    function renderPool() {
        const grid = document.getElementById('pool-grid');
        grid.innerHTML = '';
        const list = championDB.filter(c => c.roles.includes(state.myLane));
        list.sort((a, b) => a.name.localeCompare(b.name));
        list.forEach(c => {
            const div = document.createElement('div');
            div.className = 'champ-card' + (state.myPool.includes(c.id) ? ' selected' : '');
            div.dataset.name = c.name; 
            div.innerHTML = `<img src="${getImg(c.id)}"><span>${c.name}</span>`;
            div.onclick = () => {
                if(state.myPool.includes(c.id)) {
                    state.myPool = state.myPool.filter(id => id !== c.id);
                    div.classList.remove('selected');
                } else {
                    if(state.myPool.length >= 7) return alert('최대 7개까지입니다.');
                    state.myPool.push(c.id);
                    div.classList.add('selected');
                }
                document.getElementById('pool-count').innerText = state.myPool.length;
            };
            grid.appendChild(div);
        });
    }

    function filterPoolGrid() {
        const query = document.getElementById('pool-search-input').value.toLowerCase();
        const cards = document.querySelectorAll('#pool-grid .champ-card');
        cards.forEach(card => {
            const name = card.dataset.name.toLowerCase();
            if(name.includes(query)) card.style.display = 'block'; 
            else card.style.display = 'none'; 
        });
    }

    // --- Step 3 (Integrated Ban Phase) ---
    function initBanPhase() {
        renderBannedList(); // 상단 밴 목록 표시
        renderBanSelectionGrid(); // 하단 전체 챔피언 그리드 표시
        document.getElementById('ban-search-input').value = '';
    }

    // 1. 상단 밴 상태 바 렌더링
    function renderBannedList() {
        const container = document.getElementById('ban-status-bar');
        container.innerHTML = '';
        
        state.bannedChampions.forEach(id => {
            const div = document.createElement('div');
            div.className = 'ban-icon';
            div.innerHTML = `<img src="${getImg(id)}">`;
            div.onclick = () => toggleBan(id); // 클릭 시 밴 취소
            container.appendChild(div);
        });

        document.getElementById('ban-count').innerText = state.bannedChampions.length;
    }

    // 2. 하단 밴 선택 그리드 렌더링
    function renderBanSelectionGrid() {
        const grid = document.getElementById('ban-selection-grid');
        grid.innerHTML = '';
        
        // 이름 순 정렬해서 보여주기
        const sortedDB = [...championDB].sort((a, b) => a.name.localeCompare(b.name));

        sortedDB.forEach(c => {
            const div = document.createElement('div');
            div.className = 'champ-card';
            div.dataset.name = c.name;

            // 이미 밴 된 챔피언 표시
            if(state.bannedChampions.includes(c.id)) {
                div.classList.add('banned-highlight');
            }

            div.innerHTML = `<img src="${getImg(c.id)}"><span style="color:#ccc">${c.name}</span>`;
            div.onclick = () => toggleBan(c.id);
            grid.appendChild(div);
        });
    }

    // 3. 밴 토글 함수 (추가/삭제)
    function toggleBan(id) {
        if (state.bannedChampions.includes(id)) {
            // 이미 있으면 삭제
            state.bannedChampions = state.bannedChampions.filter(c => c !== id);
        } else {
            // 없으면 추가 (10개 제한)
            if (state.bannedChampions.length >= 10) {
                alert("최대 10명까지만 금지할 수 있습니다.");
                return;
            }
            state.bannedChampions.push(id);
        }
        // UI 갱신
        renderBannedList();
        renderBanSelectionGrid();
        
        // 검색 필터 상태 유지
        filterBanGrid();
    }

    // 4. 밴 검색 필터
    function filterBanGrid() {
        const query = document.getElementById('ban-search-input').value.toLowerCase();
        const cards = document.querySelectorAll('#ban-selection-grid .champ-card');
        cards.forEach(card => {
            const name = card.dataset.name.toLowerCase();
            if(name.includes(query)) card.style.display = 'block';
            else card.style.display = 'none';
        });
    }

    // --- Step 4 (Pick) ---
    function initDraft() {
        // [수정] 픽 화면 상단에 밴 된 챔피언 표시
        const banDisplay = document.getElementById('ban-display-bar');
        banDisplay.innerHTML = '';
        if(state.bannedChampions.length === 0) {
            banDisplay.innerHTML = '<span style="font-size:12px; color:#666;">금지된 챔피언 없음</span>';
        } else {
            state.bannedChampions.forEach(id => {
                const img = document.createElement('img');
                img.src = getImg(id);
                img.className = 'banned-small';
                img.title = championDB.find(c => c.id === id).name;
                banDisplay.appendChild(img);
            });
        }

        const poolBar = document.getElementById('my-pool-bar');
        poolBar.innerHTML = '';
        if(state.myPool.length === 0) {
            poolBar.innerHTML = '<span style="color:#666">선택한 챔피언이 없습니다.</span>';
        } else {
            state.myPool.forEach(id => {
                const img = document.createElement('img');
                img.src = getImg(id);
                img.className = 'pool-mini-img';
                img.title = championDB.find(c => c.id === id).name;
                poolBar.appendChild(img);
            });
        }

        document.querySelectorAll('.slot').forEach(slot => {
            const side = slot.dataset.side;
            const role = slot.dataset.role;
            const id = state.draft[side][role];

            if(side === 'ally' && role === state.myLane) {
                slot.className = 'slot disabled';
                slot.innerHTML = '<span style="color:var(--accent-color); font-weight:bold; width:100%; text-align:center;">ME</span>';
                slot.onclick = null;
            } else {
                slot.className = 'slot';
                slot.onclick = function() { openSelector(this); };
                if(id) {
                    const c = championDB.find(x => x.id === id);
                    slot.innerHTML = `<img src="${getImg(id)}"><span>${c.name}</span>`;
                } else {
                    slot.innerHTML = role.charAt(0) + role.slice(1).toLowerCase();
                }
            }
        });
        document.getElementById('result-area').style.display = 'none';
    }

    function isChampTaken(id) {
        // 밴 목록 체크
        if (state.bannedChampions.includes(id)) return true;
        // 픽 목록 체크
        for (let key in state.draft.ally) { if (state.draft.ally[key] === id) return true; }
        for (let key in state.draft.enemy) { if (state.draft.enemy[key] === id) return true; }
        return false;
    }

    // --- 모달 로직 (Pick 전용) ---
    function openSelector(el) {
        state.currentSelector = { 
            side: el.dataset.side, 
            role: el.dataset.role, 
            dom: el
        };
        
        document.getElementById('modal-overlay').style.display = 'flex';
        const input = document.getElementById('champ-search');
        input.value = '';
        input.focus();
        renderModal(''); 
    }

    function closeModal() {
        document.getElementById('modal-overlay').style.display = 'none';
    }

    function renderModal(query) {
        const grid = document.getElementById('modal-list');
        grid.innerHTML = '';
        
        const currentRole = state.currentSelector.role;
        let filtered;

        if (!query) {
            filtered = championDB.filter(c => c.roles.includes(currentRole));
        } else {
            filtered = championDB.filter(c => c.name.includes(query));
        }
        filtered.sort((a, b) => a.name.localeCompare(b.name));
        if(filtered.length === 0) {
            grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color:#666;">검색 결과가 없습니다.</div>';
            return;
        }

        filtered.forEach(c => {
            const div = document.createElement('div');
            div.className = 'champ-card';
            
            if (isChampTaken(c.id)) {
                div.style.opacity = '0.3';
                div.style.cursor = 'not-allowed';
            }

            div.innerHTML = `<img src="${getImg(c.id)}"><span style="color:#ccc">${c.name}</span>`;
            
            div.onclick = () => {
                if (isChampTaken(c.id)) return alert("이미 선택되거나 금지된 챔피언입니다.");

                state.draft[state.currentSelector.side][state.currentSelector.role] = c.id;
                const dom = state.currentSelector.dom;
                dom.innerHTML = `<img src="${getImg(c.id)}"><span>${c.name}</span>`;
                closeModal();
            };
            grid.appendChild(div);
        });
    }

    function filterChampions() {
        renderModal(document.getElementById('champ-search').value);
    }

    // --- Recommendation ---
    function getRecommendation() {
        const list = document.getElementById('recommendation-list');
        list.innerHTML = '';

        const takenIds = [...state.bannedChampions]; // 밴 목록 추가
        const allyChamps = [];
        
        Object.values(state.draft.ally).forEach(id => { 
            if(id) {
                takenIds.push(id);
                allyChamps.push(championDB.find(c => c.id === id));
            }
        });
        Object.values(state.draft.enemy).forEach(id => { 
            if(id) takenIds.push(id);
        });

        // 밸런스 분석
        let adCount = 0;
        let apCount = 0;
        let tankCount = 0;

        allyChamps.forEach(c => {
            if (c.damage === 'AD') adCount++;
            if (c.damage === 'AP') apCount++;
            if (c.type === 'TANK' || c.damage === 'MIX') tankCount++;
        });

        let adviceMsg = "무난한 픽입니다.";
        let recommendType = 'ALL'; 

        if (adCount >= 3 && apCount === 0) {
            adviceMsg = "팀에 AD가 너무 많습니다. <b>AP 챔피언</b>을 추천합니다.";
            recommendType = 'AP';
        } else if (apCount >= 3 && adCount === 0) {
            adviceMsg = "팀에 AP가 너무 많습니다. <b>AD 챔피언</b>을 추천합니다.";
            recommendType = 'AD';
        } else if (tankCount === 0 && allyChamps.length >= 2) {
            adviceMsg = "팀에 탱커가 없습니다. <b>단단한 챔피언</b>이 좋습니다.";
            recommendType = 'TANK';
        }

        let myPicks = championDB.filter(c => state.myPool.includes(c.id) && !takenIds.includes(c.id));
        
        let scoredPicks = myPicks.map(c => {
            let score = 0;
            if (recommendType === 'AP' && (c.damage === 'AP' || c.damage === 'MIX')) score += 10;
            if (recommendType === 'AD' && c.damage === 'AD') score += 10;
            if (recommendType === 'TANK' && (c.type === 'TANK' || c.damage === 'MIX')) score += 10;
            return { champ: c, score: score + Math.random() * 5 }; 
        });

        scoredPicks.sort((a, b) => b.score - a.score);

        if(scoredPicks.length === 0) {
             list.innerHTML = '<div style="padding:20px; color:#888;">추천 가능한 챔피언이 없습니다.</div>';
        } else {
            scoredPicks.slice(0, 3).forEach((item, i) => {
                const p = item.champ;
                let reason = "숙련도 기반 추천";
                if(item.score > 8) reason = `팀 밸런스 최적화 (${recommendType} 필요)`;
                
                list.innerHTML += `
                    <div class="recommend-card">
                        <img src="${getImg(p.id)}" class="recommend-img">
                        <div class="rec-info">
                            <h3>BEST ${i+1}: ${p.name}</h3>
                            <small>${reason}</small>
                        </div>
                    </div>`;
            });
        }

        let others = championDB.filter(c => 
            !state.myPool.includes(c.id) && 
            c.roles.includes(state.myLane) && 
            !takenIds.includes(c.id)
        );
        
        let bestHidden = others.filter(c => {
             if (recommendType === 'AP') return c.damage === 'AP';
             if (recommendType === 'AD') return c.damage === 'AD';
             if (recommendType === 'TANK') return c.type === 'TANK';
             return true;
        });

        if(bestHidden.length > 0) {
            const hidden = bestHidden[Math.floor(Math.random() * bestHidden.length)];
            list.innerHTML += `
                <div class="recommend-card wildcard">
                    <img src="${getImg(hidden.id)}" class="recommend-img">
                    <div class="rec-info">
                        <h3>HIDDEN GEM: ${hidden.name}</h3>
                        <small>${adviceMsg}</small>
                    </div>
                </div>`;
        } else if (others.length > 0) {
            const hidden = others[Math.floor(Math.random() * others.length)];
             list.innerHTML += `
                <div class="recommend-card wildcard">
                    <img src="${getImg(hidden.id)}" class="recommend-img">
                    <div class="rec-info">
                        <h3>HIDDEN GEM: ${hidden.name}</h3>
                        <small>변수 창출을 위한 조커 픽</small>
                    </div>
                </div>`;
        }

        const resArea = document.getElementById('result-area');
        resArea.style.display = 'block';
        resArea.scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>
