<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PICK.GG - LoL Pick Simulator</title>
    <style>
        /* --- 기존 CSS 유지 --- */
        :root {
            --bg-color: #010a13;
            --text-color: #f0f0f0;
            --accent-color: #c8aa6e; /* LoL Gold */
            --box-bg: #1e2328;
            --border-color: #463714;
            --hextech-blue: #0ac8b9;
            --danger-color: #ff4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, #1a1a20 0%, #000 100%);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* 드래그 방지 */
        .site-logo, .btn, .lane-card, .champ-card, .slot, .ban-icon, .pool-mini-img, h1, h2, h3, p, span {
            -webkit-user-select: none; user-select: none;
        }
        input, .recommend-card { user-select: text; }

        .container {
            width: 100%;
            max-width: 950px;
            background-color: var(--box-bg);
            border: 2px solid var(--border-color);
            box-shadow: 0 0 30px rgba(0,0,0,0.8), inset 0 0 50px rgba(0,0,0,0.5);
            padding: 40px;
            border-radius: 4px;
            text-align: center;
            position: relative;
        }

        /* --- 사이트 로고 --- */
        .site-logo {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #444;
        }
        .site-logo h1 {
            font-size: 3rem; margin: 0; color: var(--accent-color);
            text-shadow: 0 0 15px rgba(200, 170, 110, 0.3);
            letter-spacing: 2px; font-weight: 800; text-transform: uppercase;
        }
        .site-logo h1 span { color: #fff; }
        .site-logo p { color: #888; margin: 8px 0 0 0; font-size: 1rem; letter-spacing: 1px; }

        h2 { color: var(--accent-color); font-size: 1.5rem; margin-bottom: 20px; text-transform: uppercase; }
        
        /* 화면 전환 */
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 버튼 --- */
        .btn-group { margin-top: 30px; display: flex; justify-content: center; gap: 15px; }
        .btn {
            background-color: var(--box-bg); color: var(--accent-color);
            border: 1px solid var(--accent-color); padding: 10px 25px;
            font-weight: bold; cursor: pointer; font-size: 14px;
            transition: 0.2s; text-transform: uppercase;
        }
        .btn:hover { background-color: var(--accent-color); color: #000; }
        .btn-secondary { border-color: #666; color: #888; }
        .btn-secondary:hover { background-color: #333; color: #fff; border-color: #888; }

        /* 헥스테크 버튼 */
        .btn-hextech {
            background: linear-gradient(135deg, #091428 0%, #005a82 100%);
            border: 2px solid var(--hextech-blue); color: #fff;
            padding: 15px 40px; font-size: 18px; font-weight: 800; letter-spacing: 1px;
            box-shadow: 0 0 15px rgba(10, 200, 185, 0.4), inset 0 0 10px rgba(10, 200, 185, 0.2);
            text-shadow: 0 0 5px rgba(255,255,255,0.5); position: relative;
            clip-path: polygon(10% 0, 100% 0, 100% 90%, 90% 100%, 0 100%, 0 10%);
            transition: all 0.3s ease;
        }
        .btn-hextech:hover {
            background: linear-gradient(135deg, #005a82 0%, #0ac8b9 100%);
            box-shadow: 0 0 25px rgba(10, 200, 185, 0.8); transform: scale(1.05);
        }
        .btn-hextech:active { transform: scale(0.98); }

        /* --- Step 1 --- */
        .lane-grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .lane-card {
            width: 120px; height: 140px; background-color: #111;
            border: 2px solid #333; box-sizing: border-box;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            flex-direction: column; transition: all 0.2s;
        }
        .lane-card:hover { transform: translateY(-5px); border-color: #666; }
        .lane-card.selected { 
            border-color: var(--accent-color);
            background: linear-gradient(to bottom, #2c281e, #111);
            box-shadow: 0 0 20px rgba(200,170,110,0.2); 
        }
        .lane-img { width: 64px; height: 64px; margin-bottom: 15px; filter: grayscale(100%); transition: 0.2s; }
        .lane-card:hover .lane-img, .lane-card.selected .lane-img { filter: grayscale(0%); }

        /* --- Step 2 & 3 (Pool & Ban Grid) --- */
        .pool-search-container { margin-bottom: 15px; }
        .pool-search-bar {
            width: 100%; max-width: 300px; padding: 10px;
            background: #000; border: 1px solid #444; color: #fff; text-align: center;
        }
        .pool-search-bar:focus { outline: none; border-color: var(--accent-color); }

        .champ-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px;
            height: 450px; overflow-y: auto; overflow-x: hidden; padding: 15px; background: #0f1012; border: 1px solid #333;
            align-content: start;
        }
        .champ-card { 
            cursor: pointer; position: relative; transition: 0.2s; border: 2px solid transparent; padding: 2px;
        }
        .champ-card:hover { transform: scale(1.05); z-index: 10; background: #222; }
        .champ-card img { width: 100%; display: block; }
        .champ-card.selected { border-color: var(--accent-color); } /* Pool 선택 */
        .champ-card.banned-highlight { border-color: var(--danger-color); opacity: 0.5; filter: grayscale(100%); } /* Ban 선택 */
        
        .champ-card.selected img { filter: brightness(1.1); }
        .champ-card span { 
            display: block; font-size: 12px; margin-top: 5px; color: #888; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; letter-spacing: -0.5px;  
        }        
        .champ-card.selected span { color: var(--accent-color); font-weight: bold; }

        /* --- Step 3 (Ban) UI --- */
        #ban-status-bar {
            display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;
            padding: 15px; background: rgba(50, 10, 10, 0.3); border: 1px solid #522; 
            min-height: 50px; flex-wrap: wrap;
        }
        .ban-icon {
            width: 48px; height: 48px; border: 2px solid var(--danger-color); 
            cursor: pointer; position: relative;
        }
        .ban-icon img { width: 100%; height: 100%; }
        .ban-icon::after {
            content: "✕"; position: absolute; top:0; left:0; width:100%; height:100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: red; opacity: 0; background: rgba(0,0,0,0.5);
            transition: 0.2s;
        }
        .ban-icon:hover::after { opacity: 1; }

        /* --- Step 4 (Pick) --- */
        #ban-display-bar {
            display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; opacity: 0.8;
            padding: 10px; background: rgba(0,0,0,0.3);
        }
        .banned-small {
            width: 32px; height: 32px; border: 1px solid #555; filter: grayscale(100%); opacity: 0.7;
        }
        
        #my-pool-bar {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 30px;
            padding: 10px; background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 50px;
            min-height: 50px; align-items: center;
        }
        .pool-mini-img {
            width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--accent-color);
            transition: 0.2s; cursor: help;
        }
        
        .draft-container { display: flex; justify-content: space-between; gap: 20px; }
        .team-column { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .team-title { font-size: 1.1rem; margin-bottom: 10px; color: #fff; font-weight: bold; text-transform: uppercase; }
        
        .slot {
            height: 64px; background: #131313; border: 1px solid #333;
            display: flex; align-items: center; padding: 0 10px;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .slot:hover { border-color: #666; background: #1a1a1a; }
        .slot.disabled { 
            cursor: default; opacity: 0.8; border: 1px solid var(--accent-color); background: #1e1810;
        }
        .slot img { width: 44px; height: 44px; border: 1px solid #444; margin-right: 12px; object-fit: cover; }
        
        .mid-action { width: 180px; display: flex; flex-direction: column; justify-content: center; gap: 15px; align-items: center; }

        /* --- Result --- */
        #result-area { margin-top: 40px; border-top: 1px solid #333; padding-top: 30px; animation: fadeIn 0.5s; }
        .recommend-card {
            background: #1a1a1a; padding: 15px; margin-bottom: 12px;
            border-left: 4px solid var(--accent-color);
            display: flex; align-items: center; gap: 20px; text-align: left;
            transition: 0.2s;
        }
        .recommend-card.wildcard { border-left-color: var(--danger-color); background: #251010; }
        .recommend-img { width: 64px; height: 64px; border: 1px solid #555; }
        .rec-info h3 { margin: 0 0 5px 0; color: var(--accent-color); font-size: 1.2rem; }
        .rec-score { float: right; font-size: 1.5rem; color: #fff; font-weight: bold; }
        .wildcard .rec-info h3 { color: var(--danger-color); }
        .rec-tags { font-size: 0.8rem; color: #888; margin-top: 5px; }
        .tag-match { color: #8f8; }
        .tag-bad { color: #f88; }

        /* --- 모달창 --- */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px);
        }
        .modal-content { 
            background: var(--box-bg); width: 90%; max-width: 500px; padding: 30px; 
            border: 1px solid var(--accent-color); box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .search-bar { 
            width: 100%; padding: 12px; background: #000; border: 1px solid #555; 
            color: #fff; margin-bottom: 20px; box-sizing: border-box; font-size: 1rem;
        }
        .search-results { 
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; 
            height: 350px; overflow-y: auto; overflow-x: hidden; align-content: start;
        }
        
        img { text-indent: -10000px; }
        img:not([src]), img[src=""] { visibility: hidden; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #444; }
        ::-webkit-scrollbar-track { background: #000; }
    </style>
</head>
<body>

<div class="container">
    <div class="site-logo">
        <h1><span>PICK</span> .GG</h1>
        <p>승리를 위한 베스트 픽 시뮬레이터</p>
    </div>

    <!-- Step 1: 라인 선택 -->
    <div id="step-1" class="step active">
        <h2>플레이할 라인을 선택하세요</h2>
        <div class="lane-grid">
            <div class="lane-card" onclick="selectLane('TOP')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-top.png" class="lane-img">
                <div>TOP</div>
            </div>
            <div class="lane-card" onclick="selectLane('JUNGLE')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-jungle.png" class="lane-img">
                <div>JUNGLE</div>
            </div>
            <div class="lane-card" onclick="selectLane('MID')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-middle.png" class="lane-img">
                <div>MID</div>
            </div>
            <div class="lane-card" onclick="selectLane('ADC')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-bottom.png" class="lane-img">
                <div>ADC</div>
            </div>
            <div class="lane-card" onclick="selectLane('SUPPORT')">
                <img src="https://raw.communitydragon.org/latest/plugins/rcp-fe-lol-clash/global/default/assets/images/position-selector/positions/icon-position-utility.png" class="lane-img">
                <div>SUPPORT</div>
            </div>
        </div>
        <div class="btn-group">
            <button class="btn" onclick="goToStep(2)">챔피언 설정하기</button>
        </div>
    </div>

    <!-- Step 2: 챔피언 풀 -->
    <div id="step-2" class="step">
        <h2>내 챔피언 풀 설정</h2>
        <p style="color:#888; margin-bottom:10px;">자신있는 챔피언을 선택하세요 (<span id="pool-count" style="color:var(--accent-color)">0</span> / 7)</p>
        <div class="pool-search-container">
            <input type="text" id="pool-search-input" class="pool-search-bar" placeholder="챔피언 찾기..." onkeyup="filterPoolGrid()">
        </div>
        <div class="champ-grid" id="pool-grid"></div>
        <div class="btn-group">
            <button class="btn btn-secondary" onclick="goToStep(1)">이전 단계</button>
            <button class="btn" onclick="goToStep(3)">밴픽(Ban) 단계로</button>
        </div>
    </div>

    <!-- Step 3: 통합 밴 단계 -->
    <div id="step-3" class="step">
        <h2>금지 챔피언 선택 (BAN)</h2>
        <p style="color:#888; margin-bottom:10px;">이번 게임에서 금지된 챔피언을 선택하세요. (<span id="ban-count" style="color:var(--danger-color)">0</span> / 10)</p>
        <div id="ban-status-bar"></div>
        <div class="pool-search-container">
            <input type="text" id="ban-search-input" class="pool-search-bar" placeholder="금지할 챔피언 검색..." onkeyup="filterBanGrid()">
        </div>
        <div class="champ-grid" id="ban-selection-grid"></div>
        <div class="btn-group">
            <button class="btn btn-secondary" onclick="goToStep(2)">이전 단계</button>
            <button class="btn" onclick="goToStep(4)">픽(Pick) 단계로</button>
        </div>
    </div>

    <!-- Step 4: 픽 단계 -->
    <div id="step-4" class="step">
        <h2>픽(PICK) 상황 입력</h2>
        
        <div style="text-align:center; margin-bottom:5px;">
            <span style="font-size:12px; color:#ff5c5c;">BANNED CHAMPIONS</span>
        </div>
        <div id="ban-display-bar"></div>

        <p style="margin:15px 0 5px 0; font-size:12px; color:#888;">MY CHAMPION POOL</p>
        <div id="my-pool-bar"></div>

        <div class="draft-container">
            <div class="team-column">
                <div class="team-title" style="color:#5c9dff">아군 (OUR TEAM)</div>
                <div class="slot" data-side="ally" data-role="TOP" onclick="openSelector(this)">Top</div>
                <div class="slot" data-side="ally" data-role="JUNGLE" onclick="openSelector(this)">Jungle</div>
                <div class="slot" data-side="ally" data-role="MID" onclick="openSelector(this)">Mid</div>
                <div class="slot" data-side="ally" data-role="ADC" onclick="openSelector(this)">ADC</div>
                <div class="slot" data-side="ally" data-role="SUPPORT" onclick="openSelector(this)">Support</div>
            </div>
            <div class="mid-action">
                <button class="btn btn-hextech" onclick="getRecommendation()">추천 픽<br>검색</button>
                <button class="btn btn-secondary" onclick="goToStep(3)" style="margin-top:10px;">밴 다시하기</button>
            </div>
            <div class="team-column">
                <div class="team-title" style="color:#ff5c5c">적군 (ENEMY TEAM)</div>
                <div class="slot" data-side="enemy" data-role="TOP" onclick="openSelector(this)">Top</div>
                <div class="slot" data-side="enemy" data-role="JUNGLE" onclick="openSelector(this)">Jungle</div>
                <div class="slot" data-side="enemy" data-role="MID" onclick="openSelector(this)">Mid</div>
                <div class="slot" data-side="enemy" data-role="ADC" onclick="openSelector(this)">ADC</div>
                <div class="slot" data-side="enemy" data-role="SUPPORT" onclick="openSelector(this)">Support</div>
            </div>
        </div>

        <div id="result-area" style="display:none;">
            <h2>AI 분석 추천 픽</h2>
            <div id="recommendation-list"></div>
        </div>
    </div>
</div>

<div id="modal-overlay">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--accent-color);">챔피언 선택</h3>
        <p style="font-size:12px; color:#888; margin-bottom:10px;">기본적으로 해당 라인 챔피언이 보입니다.</p>
        <input type="text" class="search-bar" id="champ-search" placeholder="챔피언 검색..." onkeyup="filterChampions()">
        <div class="search-results" id="modal-list"></div>
        <button class="btn btn-secondary" style="width:100%; margin-top:15px;" onclick="closeModal()">취소</button>
    </div>
</div>

<script>
    // [1] 데이터베이스 초기화 및 확장
    // 기본 DB는 간단하게 유지하고, 스크립트 실행 시 상세 스탯을 주입하는 방식
    const rawDB = [
        { id: 'Aatrox', name: '아트록스', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Ahri', name: '아리', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Akali', name: '아칼리', roles: ['MID', 'TOP'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Alistar', name: '알리스타', roles: ['SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Amumu', name: '아무무', roles: ['JUNGLE', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Ashe', name: '애쉬', roles: ['ADC', 'SUPPORT'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Azir', name: '아지르', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Blitzcrank', name: '블리츠크랭크', roles: ['SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Braum', name: '브라움', roles: ['SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Caitlyn', name: '케이틀린', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Camille', name: '카밀', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Darius', name: '다리우스', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'DrMundo', name: '문도 박사', roles: ['TOP', 'JUNGLE'], damage: 'MIX', type: 'TANK' },
        { id: 'Ezreal', name: '이즈리얼', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Fiora', name: '피오라', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Garen', name: '가렌', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Hecarim', name: '헤카림', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Janna', name: '잔나', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'JarvanIV', name: '자르반 4세', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Jax', name: '잭스', roles: ['TOP', 'JUNGLE'], damage: 'MIX', type: 'FIGHTER' },
        { id: 'Jayce', name: '제이스', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Jhin', name: '진', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Jinx', name: '징크스', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Kaisa', name: '카이사', roles: ['ADC'], damage: 'MIX', type: 'MARKSMAN' },
        { id: 'Karma', name: '카르마', roles: ['SUPPORT', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Kayn', name: '케인', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Khazix', name: '카직스', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'LeeSin', name: '리신', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Leona', name: '레오나', roles: ['SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Lucian', name: '루시안', roles: ['ADC', 'MID'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Lulu', name: '룰루', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Lux', name: '럭스', roles: ['SUPPORT', 'MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Malphite', name: '말파이트', roles: ['TOP', 'MID', 'SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'MasterYi', name: '마스터 이', roles: ['JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Mordekaiser', name: '모데카이저', roles: ['TOP'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Morgana', name: '모르가나', roles: ['SUPPORT', 'JUNGLE'], damage: 'AP', type: 'MAGE' },
        { id: 'Nami', name: '나미', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Nasus', name: '나서스', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Nautilus', name: '노틸러스', roles: ['SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Nidalee', name: '니달리', roles: ['JUNGLE'], damage: 'AP', type: 'ASSASSIN' },
        { id: 'Orianna', name: '오리아나', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Ornn', name: '오른', roles: ['TOP'], damage: 'MIX', type: 'TANK' },
        { id: 'Pyke', name: '파이크', roles: ['SUPPORT'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Rakan', name: '라칸', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Renekton', name: '레넥톤', roles: ['TOP', 'MID'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Riven', name: '리븐', roles: ['TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Samira', name: '사미라', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Sejuani', name: '세주아니', roles: ['JUNGLE', 'TOP'], damage: 'AP', type: 'TANK' },
        { id: 'Sett', name: '세트', roles: ['TOP', 'SUPPORT'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Shen', name: '쉔', roles: ['TOP', 'SUPPORT'], damage: 'MIX', type: 'TANK' },
        { id: 'Sion', name: '사이온', roles: ['TOP'], damage: 'AD', type: 'TANK' },
        { id: 'Sona', name: '소나', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Soraka', name: '소라카', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Sylas', name: '사일러스', roles: ['MID', 'JUNGLE'], damage: 'AP', type: 'FIGHTER' },
        { id: 'Syndra', name: '신드라', roles: ['MID'], damage: 'AP', type: 'MAGE' },
        { id: 'Talon', name: '탈론', roles: ['JUNGLE', 'MID'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Thresh', name: '쓰레쉬', roles: ['SUPPORT'], damage: 'AP', type: 'TANK' },
        { id: 'Tristana', name: '트리스타나', roles: ['ADC', 'MID'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Vayne', name: '베인', roles: ['ADC', 'TOP'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Veigar', name: '베이가', roles: ['MID', 'SUPPORT'], damage: 'AP', type: 'MAGE' },
        { id: 'Vi', name: '바이', roles: ['JUNGLE'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Vladimir', name: '블라디미르', roles: ['MID', 'TOP'], damage: 'AP', type: 'MAGE' },
        { id: 'Xayah', name: '자야', roles: ['ADC'], damage: 'AD', type: 'MARKSMAN' },
        { id: 'Yasuo', name: '야스오', roles: ['MID', 'TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Yone', name: '요네', roles: ['MID', 'TOP'], damage: 'AD', type: 'FIGHTER' },
        { id: 'Yuumi', name: '유미', roles: ['SUPPORT'], damage: 'AP', type: 'SUPPORT' },
        { id: 'Zac', name: '자크', roles: ['JUNGLE', 'TOP'], damage: 'AP', type: 'TANK' },
        { id: 'Zed', name: '제드', roles: ['MID', 'JUNGLE'], damage: 'AD', type: 'ASSASSIN' },
        { id: 'Zoe', name: '조이', roles: ['MID'], damage: 'AP', type: 'MAGE' },
    ];

    // DB 확장 함수
    function expandChampionData(db) {
        // 특정 챔피언에 대한 상세 데이터 오버라이드 (예시 데이터)
        const overrides = {
            'Malphite': { 
                stats: { meta: 8, ad_ap: 1, tankiness: 10, burst: 6, dps: 2, cc: 9, safety: 6 },
                synergy: ['Yasuo', 'Orianna'], 
                tags: ['Initiator', 'Tank', 'Anti-AD'] 
            },
            'Lucian': {
                stats: { meta: 7, ad_ap: 10, tankiness: 2, burst: 9, dps: 7, cc: 1, safety: 7 },
                synergy: ['Nami', 'Braum', 'Milio'],
                tags: ['Early_Game', 'Mobile']
            },
            'Nami': {
                stats: { meta: 6, ad_ap: 0, tankiness: 2, burst: 3, dps: 2, cc: 7, safety: 5 },
                synergy: ['Lucian', 'Draven'],
                tags: ['Enchanter']
            },
            'Yasuo': {
                stats: { meta: 6, ad_ap: 10, tankiness: 4, burst: 8, dps: 9, cc: 5, safety: 4 },
                synergy: ['Malphite', 'Diana', 'Zac'],
                tags: ['Hypercarry', 'Combo']
            },
            'Ornn': {
                stats: { meta: 9, ad_ap: 3, tankiness: 10, burst: 5, dps: 4, cc: 9, safety: 7 },
                synergy: [],
                tags: ['Tank', 'Scaler', 'Utility']
            },
            'Vayne': {
                stats: { meta: 5, ad_ap: 10, tankiness: 2, burst: 6, dps: 10, cc: 3, safety: 4 },
                synergy: ['Lulu'],
                tags: ['Tank_Buster', 'Late_Game']
            },
            'Zed': {
                stats: { meta: 6, ad_ap: 10, tankiness: 2, burst: 10, dps: 4, cc: 1, safety: 8 },
                synergy: [],
                tags: ['Assassin', 'Squishy_Killer']
            }
        };

        return db.map(c => {
            const extra = overrides[c.id] || {};
            
            // 기본값 자동 생성 (오버라이드 없으면 타입 기반 추정)
            const defaultStats = {
                meta: 5,
                ad_ap: c.damage === 'AD' ? 10 : (c.damage === 'AP' ? 0 : 5),
                tankiness: c.type === 'TANK' ? 9 : (c.type === 'FIGHTER' ? 6 : 2),
                burst: c.type === 'ASSASSIN' || c.type === 'MAGE' ? 8 : 4,
                dps: c.type === 'MARKSMAN' ? 9 : 4,
                cc: c.type === 'TANK' || c.roles.includes('SUPPORT') ? 7 : 3,
                safety: 5
            };

            return {
                ...c,
                stats: extra.stats || defaultStats,
                synergy: extra.synergy || [],
                tags: extra.tags || []
            };
        });
    }

    const championDB = expandChampionData(rawDB);

    // --- State Management ---
    let state = {
        myLane: null,
        myPool: [],
        bannedChampions: [], 
        draft: {
            ally: { TOP: null, JUNGLE: null, MID: null, ADC: null, SUPPORT: null },
            enemy: { TOP: null, JUNGLE: null, MID: null, ADC: null, SUPPORT: null }
        },
        currentSelector: null
    };

    function getImg(id) {
        return `https://ddragon.leagueoflegends.com/cdn/14.23.1/img/champion/${id}.png`;
    }

    // --- Step 1 ~ 3 UI Logic (기존과 동일하지만 간단히 유지) ---
    function selectLane(lane) {
        if(state.myLane !== lane) {
            state.myPool = [];
            document.getElementById('pool-count').innerText = "0";
        }
        state.myLane = lane;
        document.querySelectorAll('.lane-card').forEach(c => c.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
    }

    function goToStep(num) {
        if(num === 2 && !state.myLane) return alert('라인을 선택해주세요!');
        if(num >= 3 && state.myPool.length === 0) return alert('챔피언을 선택해주세요!');
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('step-' + num).classList.add('active');
        if(num === 2) renderPool();
        if(num === 3) initBanPhase();
        if(num === 4) initDraft();
    }

    function renderPool() {
        const grid = document.getElementById('pool-grid');
        grid.innerHTML = '';
        const list = championDB.filter(c => c.roles.includes(state.myLane));
        list.sort((a, b) => a.name.localeCompare(b.name));
        list.forEach(c => {
            const div = document.createElement('div');
            div.className = 'champ-card' + (state.myPool.includes(c.id) ? ' selected' : '');
            div.dataset.name = c.name; 
            div.innerHTML = `<img src="${getImg(c.id)}"><span>${c.name}</span>`;
            div.onclick = () => {
                if(state.myPool.includes(c.id)) {
                    state.myPool = state.myPool.filter(id => id !== c.id);
                    div.classList.remove('selected');
                } else {
                    if(state.myPool.length >= 7) return alert('최대 7개까지입니다.');
                    state.myPool.push(c.id);
                    div.classList.add('selected');
                }
                document.getElementById('pool-count').innerText = state.myPool.length;
            };
            grid.appendChild(div);
        });
    }

    function filterPoolGrid() {
        const query = document.getElementById('pool-search-input').value.toLowerCase();
        document.querySelectorAll('#pool-grid .champ-card').forEach(card => {
            card.style.display = card.dataset.name.toLowerCase().includes(query) ? 'block' : 'none';
        });
    }

    // --- Ban Phase ---
    function initBanPhase() {
        renderBannedList();
        renderBanSelectionGrid();
    }
    function renderBannedList() {
        const container = document.getElementById('ban-status-bar');
        container.innerHTML = '';
        state.bannedChampions.forEach(id => {
            const div = document.createElement('div');
            div.className = 'ban-icon';
            div.innerHTML = `<img src="${getImg(id)}">`;
            div.onclick = () => toggleBan(id);
            container.appendChild(div);
        });
        document.getElementById('ban-count').innerText = state.bannedChampions.length;
    }
    function renderBanSelectionGrid() {
        const grid = document.getElementById('ban-selection-grid');
        grid.innerHTML = '';
        [...championDB].sort((a,b)=>a.name.localeCompare(b.name)).forEach(c => {
            const div = document.createElement('div');
            div.className = 'champ-card' + (state.bannedChampions.includes(c.id) ? ' banned-highlight' : '');
            div.dataset.name = c.name;
            div.innerHTML = `<img src="${getImg(c.id)}"><span style="color:#ccc">${c.name}</span>`;
            div.onclick = () => toggleBan(c.id);
            grid.appendChild(div);
        });
    }
    function toggleBan(id) {
        if (state.bannedChampions.includes(id)) state.bannedChampions = state.bannedChampions.filter(c => c !== id);
        else {
            if (state.bannedChampions.length >= 10) return alert("최대 10명까지만 금지할 수 있습니다.");
            state.bannedChampions.push(id);
        }
        renderBannedList();
        renderBanSelectionGrid();
        filterBanGrid();
    }
    function filterBanGrid() {
        const query = document.getElementById('ban-search-input').value.toLowerCase();
        document.querySelectorAll('#ban-selection-grid .champ-card').forEach(card => {
            card.style.display = card.dataset.name.toLowerCase().includes(query) ? 'block' : 'none';
        });
    }

    // --- Pick Phase ---
    function initDraft() {
        const banDisplay = document.getElementById('ban-display-bar');
        banDisplay.innerHTML = '';
        state.bannedChampions.forEach(id => {
            const img = document.createElement('img'); img.src = getImg(id); img.className = 'banned-small';
            banDisplay.appendChild(img);
        });

        const poolBar = document.getElementById('my-pool-bar');
        poolBar.innerHTML = '';
        state.myPool.forEach(id => {
            const img = document.createElement('img'); img.src = getImg(id); img.className = 'pool-mini-img';
            poolBar.appendChild(img);
        });

        document.querySelectorAll('.slot').forEach(slot => {
            const side = slot.dataset.side;
            const role = slot.dataset.role;
            const id = state.draft[side][role];
            if(side === 'ally' && role === state.myLane) {
                slot.className = 'slot disabled';
                slot.innerHTML = '<span style="color:var(--accent-color); font-weight:bold; width:100%; text-align:center;">ME</span>';
                slot.onclick = null;
            } else {
                slot.className = 'slot';
                slot.onclick = function() { openSelector(this); };
                if(id) {
                    const c = championDB.find(x => x.id === id);
                    slot.innerHTML = `<img src="${getImg(id)}"><span>${c.name}</span>`;
                } else {
                    slot.innerHTML = role.charAt(0) + role.slice(1).toLowerCase();
                }
            }
        });
        document.getElementById('result-area').style.display = 'none';
    }

    function isChampTaken(id) {
        if (state.bannedChampions.includes(id)) return true;
        for (let key in state.draft.ally) if (state.draft.ally[key] === id) return true;
        for (let key in state.draft.enemy) if (state.draft.enemy[key] === id) return true;
        return false;
    }

    function openSelector(el) {
        state.currentSelector = { side: el.dataset.side, role: el.dataset.role, dom: el };
        document.getElementById('modal-overlay').style.display = 'flex';
        renderModal('');
    }
    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }
    function renderModal(query) {
        const grid = document.getElementById('modal-list'); grid.innerHTML = '';
        const filtered = championDB.filter(c => !query || c.name.includes(query)).sort((a,b)=>a.name.localeCompare(b.name));
        filtered.forEach(c => {
            const div = document.createElement('div'); div.className = 'champ-card';
            if (isChampTaken(c.id)) { div.style.opacity = '0.3'; div.style.cursor = 'not-allowed'; }
            div.innerHTML = `<img src="${getImg(c.id)}"><span style="color:#ccc">${c.name}</span>`;
            div.onclick = () => {
                if (isChampTaken(c.id)) return alert("이미 선택되거나 금지된 챔피언입니다.");
                state.draft[state.currentSelector.side][state.currentSelector.role] = c.id;
                state.currentSelector.dom.innerHTML = `<img src="${getImg(c.id)}"><span>${c.name}</span>`;
                closeModal();
            };
            grid.appendChild(div);
        });
    }
    function filterChampions() { renderModal(document.getElementById('champ-search').value); }


    // ==========================================================
    // [2] 핵심 알고리즘 구현: 가중치 점수 계산 (The Engine)
    // ==========================================================
    function calculateScore(champ, context) {
        let score = 0;
        let reasons = []; // 추천 사유 기록

        // 1. 기본 메타 점수 (가중치 2배)
        score += champ.stats.meta * 2;

        // 2. 아군 조합 밸런스 보정 (Gap Analysis)
        if (context.needs.AP && champ.stats.ad_ap < 4) {
            score += 25; reasons.push("부족한 AP 보완");
        }
        if (context.needs.AD && champ.stats.ad_ap > 6) {
            score += 25; reasons.push("부족한 AD 보완");
        }
        if (context.needs.Tank && champ.stats.tankiness > 7) {
            score += 30; reasons.push("팀내 유일 탱커");
        }
        if (context.needs.CC && champ.stats.cc > 7) {
            score += 15; reasons.push("CC 셔틀 필요");
        }

        // 3. 시너지 (Synergy) - 특정 챔피언 조합
        // 아군 챔피언 목록 중에 내 단짝(best_partners)이 있는지 확인
        let synergyFound = false;
        context.allies.forEach(ally => {
            if (champ.synergy.includes(ally.id)) {
                score += 20;
                reasons.push(`${ally.name}와 시너지`);
                synergyFound = true;
            }
        });

        // 4. 적군 조합 대응 (Counter Logic)
        // A. 맞라이너 상성 (후픽인 경우)
        if (context.enemyLaner) {
            // 상세 상성 데이터가 없으므로 태그 기반 모의 계산
            // 예: 적이 암살자인데 내가 탱커면 가산점
            if (context.enemyLaner.stats.burst > 7 && champ.stats.tankiness > 7) {
                score += 15;
                reasons.push(`${context.enemyLaner.name} 카운터(탱)`);
            }
            // 적이 탱커인데 내가 지속딜(DPS)이 좋으면 가산점
            if (context.enemyLaner.stats.tankiness > 7 && champ.stats.dps > 7) {
                score += 15;
                reasons.push("탱커 녹이기 좋음");
            }
        } else {
            // B. 선픽인 경우 (맞라이너 없음)
            score += champ.stats.safety * 3; // 선픽 안정성 중요
        }

        // C. 적 전체 조합 특성 대응
        if (context.enemyStats.avgTankiness < 4 && champ.stats.burst > 7) {
            score += 10; reasons.push("물몸 학살자");
        }
        if (context.enemyStats.avgTankiness > 7 && champ.stats.dps > 7) {
            score += 10; reasons.push("탱커 처리반");
        }

        // 난수(Random) 살짝 섞어서 매번 너무 똑같은 결과 방지 (0~5점)
        score += Math.random() * 5;

        return { score, reasons };
    }


    // ==========================================================
    // [3] 최종 추천 실행 함수
    // ==========================================================
    function getRecommendation() {
        const list = document.getElementById('recommendation-list');
        list.innerHTML = '';

        // 1. 상황 인식 (Context Gathering)
        const allyChamps = Object.values(state.draft.ally).filter(id => id).map(id => championDB.find(c=>c.id===id));
        const enemyChamps = Object.values(state.draft.enemy).filter(id => id).map(id => championDB.find(c=>c.id===id));
        const enemyLanerID = state.draft.enemy[state.myLane];
        const enemyLaner = enemyLanerID ? championDB.find(c => c.id === enemyLanerID) : null;

        // 2. 조합 갭 분석 (Gap Analysis)
        let totalAD = 0, totalAP = 0, totalTank = 0, totalCC = 0;
        allyChamps.forEach(c => {
            if (c.stats.ad_ap > 5) totalAD++; else totalAP++;
            totalTank += c.stats.tankiness;
            totalCC += c.stats.cc;
        });

        const needs = {
            AD: totalAD < totalAP && totalAD < 2, // AD가 AP보다 적고 2명 미만일 때
            AP: totalAP < totalAD && totalAP < 2,
            Tank: totalTank < 15, // 단순 합계가 낮으면 탱커 필요
            CC: totalCC < 15
        };

        // 적군 평균 스탯
        let enemyTankSum = 0;
        enemyChamps.forEach(c => enemyTankSum += c.stats.tankiness);
        const enemyStats = {
            avgTankiness: enemyChamps.length > 0 ? enemyTankSum / enemyChamps.length : 5
        };

        const context = {
            allies: allyChamps,
            enemies: enemyChamps,
            enemyLaner: enemyLaner,
            needs: needs,
            enemyStats: enemyStats
        };

        // 3. 챔피언 점수 계산 (Scoring)
        // 내 챔피언 풀(Top 7) + 나머지 전체(Wildcard 찾기용) 모두 계산
        const takenIds = [...state.bannedChampions, ...Object.values(state.draft.ally), ...Object.values(state.draft.enemy)];
        
        // 내 라인에 갈 수 있는 모든 챔피언 가져오기
        let candidates = championDB.filter(c => c.roles.includes(state.myLane) && !takenIds.includes(c.id));
        
        // 점수 매기기
        let ranked = candidates.map(c => {
            const result = calculateScore(c, context);
            return { 
                champ: c, 
                score: result.score, 
                reasons: result.reasons,
                isMyPool: state.myPool.includes(c.id)
            };
        });

        // 정렬
        ranked.sort((a, b) => b.score - a.score);

        // 4. 결과 출력
        // (1) 내 풀 안에서 Top 3
        const myPoolRanked = ranked.filter(r => r.isMyPool).slice(0, 3);
        
        if(myPoolRanked.length === 0) {
            list.innerHTML = '<div style="padding:20px; color:#888;">내 풀에 남은 챔피언이 없습니다.</div>';
        } else {
            myPoolRanked.forEach((item, i) => {
                const reasonText = item.reasons.length > 0 ? item.reasons.join(', ') : '무난한 픽';
                list.innerHTML += `
                    <div class="recommend-card">
                        <img src="${getImg(item.champ.id)}" class="recommend-img">
                        <div class="rec-info" style="flex:1">
                            <h3>BEST ${i+1}: ${item.champ.name}</h3>
                            <div class="rec-tags">
                                <span class="tag-match">${reasonText}</span>
                            </div>
                        </div>
                        <div class="rec-score">${Math.round(item.score)}점</div>
                    </div>`;
            });
        }

        // (2) 히든 꿀픽 (내 풀 밖에서 점수 1등)
        const wildcard = ranked.find(r => !r.isMyPool);
        if (wildcard) {
             const reasonText = wildcard.reasons.length > 0 ? wildcard.reasons.join(', ') : '상황상 최적의 픽';
             list.innerHTML += `
                <div class="recommend-card wildcard">
                    <img src="${getImg(wildcard.champ.id)}" class="recommend-img">
                    <div class="rec-info" style="flex:1">
                        <h3>HIDDEN GEM: ${wildcard.champ.name}</h3>
                        <div class="rec-tags">
                            <span class="tag-match" style="color:#ffaaaa">${reasonText}</span>
                        </div>
                    </div>
                    <div class="rec-score" style="color:#ff5c5c">${Math.round(wildcard.score)}점</div>
                </div>`;
        }

        document.getElementById('result-area').style.display = 'block';
        document.getElementById('result-area').scrollIntoView({ behavior: 'smooth' });
    }
</script>

</body>
</html>
